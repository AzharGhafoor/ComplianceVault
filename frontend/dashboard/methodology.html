<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scoring Methodology - NIA Policy 2.0 ComplianceVault</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .app-layout {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            z-index: 100;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 700;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: var(--accent-gradient);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
            overflow-y: auto;
        }

        .nav-section {
            padding: 0.5rem 1rem;
            margin-top: 0.5rem;
        }

        .nav-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            border-radius: var(--radius-md);
            margin: 0.25rem 0.5rem;
            transition: all var(--transition-fast);
        }

        .nav-link:hover {
            background: var(--bg-glass);
            color: var(--text-primary);
        }

        .nav-link.active {
            background: var(--accent-gradient);
            color: white;
        }

        .nav-link svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
        }

        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--accent-gradient);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
        }

        .user-details {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: capitalize;
        }

        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 2rem;
            max-width: 1200px;
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: var(--text-secondary);
        }

        .methodology-section {
            margin-bottom: 2rem;
        }

        .methodology-section h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--accent-primary);
        }

        .methodology-section h3 {
            font-size: 1.125rem;
            margin: 1.5rem 0 0.75rem;
            color: var(--text-primary);
        }

        .methodology-section p {
            line-height: 1.7;
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        .formula-box {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent-primary);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: var(--radius-md);
            font-family: var(--font-mono);
        }

        .formula-box code {
            display: block;
            font-size: 1rem;
            color: var(--text-primary);
            margin: 0.5rem 0;
        }

        .status-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        .status-table th,
        .status-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .status-table th {
            background: var(--bg-secondary);
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }

        .status-table tr:hover {
            background: var(--bg-glass);
        }

        .example-box {
            background: var(--bg-glass);
            padding: 1.5rem;
            border-radius: var(--radius-md);
            margin: 1.5rem 0;
        }

        .example-box h4 {
            margin-bottom: 1rem;
            color: var(--color-info);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>

<body>
    <div class="app-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="/" class="sidebar-logo">
                    <div class="logo-icon">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z" />
                        </svg>
                    </div>
                    <span class="text-gradient">ComplianceVault</span>
                </a>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <a href="index.html" class="nav-link">
                        <svg viewBox="0 0 24 24">
                            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                            <polyline points="9 22 9 12 15 12 15 22" />
                        </svg>
                        Dashboard
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Assessment</div>
                    <a href="assessment.html" class="nav-link">
                        <svg viewBox="0 0 24 24">
                            <path d="M9 11l3 3L22 4" />
                            <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11" />
                        </svg>
                        Controls
                    </a>
                    <a href="domains.html" class="nav-link">
                        <svg viewBox="0 0 24 24">
                            <rect x="3" y="3" width="7" height="7" />
                            <rect x="14" y="3" width="7" height="7" />
                            <rect x="14" y="14" width="7" height="7" />
                            <rect x="3" y="14" width="7" height="7" />
                        </svg>
                        Domains
                    </a>
                    <a href="bia.html" class="nav-link" id="navBia">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="12 2 2 7 12 12 22 7 12 2" />
                            <polyline points="2 17 12 22 22 17" />
                            <polyline points="2 12 12 17 22 12" />
                        </svg>
                        Business Impact
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Management</div>
                    <a href="history.html" class="nav-link">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10" />
                            <polyline points="12 6 12 12 16 14" />
                        </svg>
                        Change Log
                    </a>
                    <a href="users.html" class="nav-link" id="navTeam">
                        <svg viewBox="0 0 24 24">
                            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2" />
                            <circle cx="9" cy="7" r="4" />
                            <path d="M23 21v-2a4 4 0 00-3-3.87" />
                            <path d="M16 3.13a4 4 0 010 7.75" />
                        </svg>
                        Team
                    </a>
                    <a href="methodology.html" class="nav-link active">
                        <svg viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="12" y1="16" x2="12" y2="12" />
                            <line x1="12" y1="8" x2="12.01" y2="8" />
                        </svg>
                        Scoring
                    </a>
                </div>
            </nav>
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Loading...</div>
                        <div class="user-role" id="userRole">-</div>
                    </div>
                    <button class="btn btn-icon btn-ghost" id="logoutBtn" title="Logout">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4" />
                            <polyline points="16 17 21 12 16 7" />
                            <line x1="21" y1="12" x2="9" y2="12" />
                        </svg>
                    </button>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">Compliance Scoring Methodology</h1>
                <p class="page-subtitle">Understanding how your NIA Policy 2.0 compliance scores are calculated</p>
            </div>

            <div class="glass-card methodology-section">
                <h2>Overview</h2>
                <p>ComplianceVault uses a transparent, weighted scoring system to calculate your organization's
                    compliance with Qatar's National Information Assurance (NIA) Policy 2.0. This methodology ensures
                    accurate representation of your security posture across all control domains.</p>
            </div>

            <div class="glass-card methodology-section">
                <h2>BIA & Security Levels</h2>
                <p>The Business Impact Analysis (BIA) determines your organization's Security Level, which dictates the
                    strictness of control requirements.</p>

                <table class="status-table">
                    <thead>
                        <tr>
                            <th>Security Level</th>
                            <th>Trigger Condition</th>
                            <th>Control Requirements</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-success">Low</span></td>
                            <td>Default / Low impact assets only</td>
                            <td>Baseline Controls Only</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-warning">Medium</span></td>
                            <td>At least one "Medium" impact asset</td>
                            <td>Baseline + 1 additional control per domain (if applicable)</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-danger">High</span></td>
                            <td>At least one "High" impact asset</td>
                            <td>Baseline + 2 additional controls per domain (if applicable)</td>
                        </tr>
                    </tbody>
                </table>
                <p>Your Compliance Target is dynamically adjusted based on this level.</p>
            </div>

            <div class="glass-card methodology-section">
                <h2>Evaluation Status Values</h2>
                <p>Each control in the NIA Policy 2.0 framework can be assigned one of four evaluation statuses:</p>

                <table class="status-table">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Score Value</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-success">Fully Applied</span></td>
                            <td><strong>100%</strong></td>
                            <td>Control is completely implemented and operational</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-warning">Partially Applied</span></td>
                            <td><strong>50%</strong></td>
                            <td>Control is partially (at least 50%) implemented or in progress</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-secondary">Low Applied</span></td>
                            <td><strong>25%</strong></td>
                            <td>Control has minimal (25%) implementation or legacy coverage</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-danger">Not Applied</span></td>
                            <td><strong>0%</strong></td>
                            <td>Control is not implemented</td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-neutral">Not Evaluated</span></td>
                            <td><strong>Excluded</strong></td>
                            <td>Control has not been assessed yet (not counted in calculations)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="glass-card methodology-section">
                <h2>Overall Compliance Score</h2>
                <p>Your overall compliance score represents the percentage of all evaluated controls that are fully or
                    partially implemented.</p>

                <div class="formula-box">
                    <strong>Formula:</strong>
                    <code>Overall Score = (Σ Control Scores) / (Total Evaluated Controls) × 100</code>
                    <br><br>
                    <strong>Where:</strong>
                    <code>Σ Control Scores = (Fully Applied × 1.0) + (Partially Applied × 0.5) + (Low Applied × 0.25)</code>
                    <code>Total Evaluated Controls = All controls except "Not Evaluated"</code>
                </div>

                <div class="example-box">
                    <h4>Example Calculation:</h4>
                    <p><strong>Scenario:</strong> Organization has evaluated 100 controls</p>
                    <ul style="margin-left: 1.5rem; color: var(--text-secondary);">
                        <li>50 controls: Fully Applied (50 × 1.0 = 50 points)</li>
                        <li>30 controls: Partially Applied (30 × 0.5 = 15 points)</li>
                        <li>20 controls: Low Applied (20 × 0.25 = 5 points)</li>
                    </ul>
                    <p style="margin-top: 1rem;"><strong>Calculation:</strong></p>
                    <code
                        style="display: block; background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-sm); font-family: var(--font-mono);">
                        Overall Score = (50 + 15 + 5) / 100 × 100 = 70%
                    </code>
                </div>
            </div>

            <div class="glass-card methodology-section">
                <h2>Baseline Compliance Score</h2>
                <p>The baseline score focuses only on controls marked as "Baseline" in the NIA Policy 2.0 framework.
                    These are the minimum required controls for basic compliance.</p>

                <div class="formula-box">
                    <strong>Formula:</strong>
                    <code>Baseline Score = (Σ Baseline Control Scores) / (Total Evaluated Baseline Controls) × 100</code>
                </div>

                <p>This score helps organizations prioritize their compliance efforts by focusing on the most critical
                    controls first.</p>
            </div>

            <div class="glass-card methodology-section">
                <h2>Domain Compliance Scores</h2>
                <p>Each of the 25 NIA Policy 2.0 domains (e.g., Access Control, Cryptography, Network Security) has its
                    own compliance score calculated using the same methodology as the overall score, but limited to
                    controls within that specific domain.</p>

                <div class="formula-box">
                    <strong>Formula:</strong>
                    <code>Domain Score = (Σ Domain Control Scores) / (Total Evaluated Domain Controls) × 100</code>
                </div>

                <h3>Critical Domains</h3>
                <p>Domains with a compliance score below 50% are flagged as "Critical" and require immediate attention.
                    These appear as alerts on your dashboard to help prioritize remediation efforts.</p>
            </div>

            <div class="glass-card methodology-section">
                <h2>Score Interpretation</h2>
                <p>Compliance scores are color-coded to provide quick visual feedback:</p>

                <table class="status-table">
                    <thead>
                        <tr>
                            <th>Score Range</th>
                            <th>Rating</th>
                            <th>Interpretation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>80% - 100%</strong></td>
                            <td><span class="badge badge-success">Excellent</span></td>
                            <td>Strong compliance posture</td>
                        </tr>
                        <tr>
                            <td><strong>50% - 79%</strong></td>
                            <td><span class="badge badge-warning">Good</span></td>
                            <td>Acceptable compliance with room for improvement</td>
                        </tr>
                        <tr>
                            <td><strong>0% - 49%</strong></td>
                            <td><span class="badge badge-danger">Needs Attention</span></td>
                            <td>Significant gaps requiring immediate action</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="glass-card methodology-section">
                <h2>Best Practices</h2>
                <ul style="margin-left: 1.5rem; line-height: 1.8; color: var(--text-secondary);">
                    <li><strong>Evaluate all controls:</strong> Unevaluated controls are excluded from scoring, which
                        may give an incomplete picture of your compliance status.</li>
                    <li><strong>Prioritize baseline controls:</strong> Focus on achieving high baseline compliance
                        before tackling additional controls.</li>
                    <li><strong>Address critical domains:</strong> Domains below 50% should be your top priority for
                        remediation.</li>
                    <li><strong>Provide evidence:</strong> Upload supporting documentation for all evaluated controls to
                        demonstrate compliance during audits.</li>
                    <li><strong>Regular reviews:</strong> Reassess controls periodically as your security posture
                        evolves.</li>
                </ul>
            </div>

            <div class="glass-card methodology-section">
                <h2>Transparency & Auditability</h2>
                <p>All scoring calculations are performed in real-time based on your current evaluations. The system
                    maintains a complete audit trail of all changes, including:</p>
                <ul style="margin-left: 1.5rem; line-height: 1.8; color: var(--text-secondary);">
                    <li>Who made the evaluation</li>
                    <li>When the evaluation was made</li>
                    <li>What changed (status, feedback, evidence)</li>
                    <li>Previous values for comparison</li>
                </ul>
                <p>This ensures full transparency and supports compliance audits by regulatory authorities.</p>
            </div>
        </main>
    </div>

    <script type="module">
        import { auth, isAuthenticated, getUser } from '../js/api.js';

        if (!isAuthenticated()) {
            window.location.href = '../auth/login.html';
        }

        const user = getUser();
        if (user) {
            document.getElementById('userAvatar').textContent = (user.first_name?.[0] || user.email[0]).toUpperCase();
            document.getElementById('userName').textContent = user.first_name ? `${user.first_name} ${user.last_name || ''}` : user.email;
            document.getElementById('userRole').textContent = user.role;

            // Hide admin-only nav links for non-admin users
            if (user.role !== 'admin') {
                document.getElementById('navBia')?.remove();
                document.getElementById('navTeam')?.remove();
            }
        }

        document.getElementById('logoutBtn').addEventListener('click', () => auth.logout());
    </script>
</body>

</html>